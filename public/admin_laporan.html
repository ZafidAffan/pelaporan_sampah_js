<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Daftar Laporan</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body { font-family: Arial, sans-serif; background-color: #F5F0CD; margin: 0; }
    nav { background-color: #347433; display: flex; justify-content: space-between; align-items: center; padding: 12px 20px; border-bottom-left-radius: 12px; border-bottom-right-radius: 12px; }
    .nav-links { display: flex; gap: 12px; align-items: center; }
    nav a { color: white; text-decoration: none; font-weight: bold; padding: 8px 16px; border-radius: 8px; }
    nav a:hover, nav a.active { background-color: #285f28; }
    .logout-btn { background-color: #b72e2e; padding: 8px 14px; border-radius: 8px; }
    .welcome { color: white; font-weight: bold; margin-right: 16px; }
    .container { padding: 20px; }
    h1 { color: #347433; text-align: center; }
    table { width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 12px; overflow: hidden; }
    th { background-color: #347433; color: white; padding: 12px; text-align: left; }
    td { padding: 10px; border-bottom: 1px solid #ddd; vertical-align: top; }
    img { max-width: 100px; border-radius: 8px; }
    .btn { padding: 6px 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
    .btn-proses { background-color: #f0ad4e; color: white; }
    .btn-selesai { background-color: #5cb85c; color: white; }
  </style>
</head>
<body>

<nav>
  <div class="nav-links">
    <a href="admin_dashboard.html"><i class="fas fa-chart-pie"></i> Dashboard</a>
    <a href="admin_laporan.html" class="active"><i class="fas fa-list"></i> Daftar Laporan</a>
    <a href="admin_riwayat_laporan.html"><i class="fas fa-clock-rotate-left"></i> Riwayat</a>
    <a href="admin_peta_laporan.html"><i class="fas fa-map-location-dot"></i> Peta</a>
  </div>
  <div class="nav-links">
    <span class="welcome"><i class="fas fa-user-shield"></i> Admin</span>
    <a href="admin_logout.html" class="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a>
  </div>
</nav>

<div class="container">
  <h1>Daftar Laporan Pengguna</h1>
  <table id="reportTable">
    <thead>
      <tr>
        <th>ID</th>
        <th>Deskripsi</th>
        <th>Gambar</th>
        <th>Alamat</th>
        <th>Status</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
  async function loadReports() {
    const res = await fetch("/admin/reports");
    const data = await res.json();
    if (!data.success) return alert("Gagal ambil data");

    const tbody = document.querySelector("#reportTable tbody");
    tbody.innerHTML = "";

    data.data.forEach(r => {
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td>${r.report_id}</td>
        <td>${r.description}</td>
        <td>${r.img_url ? `<img src="/upload/${r.img_url}" alt="">` : "Tidak ada"}</td>
        <td>${r.address}</td>
        <td>${r.status}</td>
        <td>
          ${r.status === "pending" ? `<button class="btn btn-proses" onclick="updateStatus(${r.report_id}, 'proses')">Proses</button>` :
            r.status === "proses" ? `<button class="btn btn-selesai" onclick="updateStatus(${r.report_id}, 'selesai')">Selesai</button>` :
            `<span style="color: green; font-weight: bold;">Selesai</span>`}
        </td>
      `;

      tbody.appendChild(tr);
    });
  }

  async function updateStatus(id, newStatus) {
    if (!confirm(`Ubah status menjadi ${newStatus.toUpperCase()}?`)) return;

    const res = await fetch("/admin/update-status", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ report_id: id, new_status: newStatus })
    });

    const data = await res.json();
    if (data.success) {
      loadReports();
    } else {
      alert("Gagal update status");
    }
  }

  loadReports();
</script>

</body>
</html>
